---
title: "Life Expectancy Prediction"
author: Vipul Gharde, Chaitanya Bachhav
output: pdf_document
date: "2022-12-05"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Abstract

We have implemented a Linear Regression model to predict the life expectancy of the human population with an adjusted R-squared value of , MSE of , and MAE of .

# Introduction

The goal of this project is to build a Linear Regression model that can predict the life expectancy of the human population based on several factors such as the amount of alcohol consumption, average Body Mass Index (BMI), immunization of various vaccines among 1-year-olds such as Hepatitis B, Polio, and Diphtheria vaccines, and more, and also derive insights into what factors are significant in determining a higher or lower life expectancy of the human population.

# Materials and Methods

## Dataset

The data related to life expectancy and health factors for 193 countries is taken from the Global Health Observatory (GHO) data repository under the World Health Organization (WHO). Its corresponding economic data was collected from the United Nations website for a period of 16 years (2000-2015).

The dataset is available at https://www.kaggle.com/datasets/kumarajarshi/life-expectancy-who.

```{r, include=FALSE}
# Load Libraries
library(corrplot)
library(car)
library(olsrr)
```

\newpage

```{r}
life = read.csv('Life Expectancy Data.csv') # Load Dataset
```

`Life Expectancy Data.csv` contains the following fields:

+ `Country` - Country Observed.
+ `Year` - Year Observed.
+ `Status` - Developed or Developing status.
+ `Life.expectancy` - Life Expectancy in age.
+ `Adult.Mortality` - Adult Mortality Rates on both sexes (probability of dying between 15-60 years/1000 population).
+ `infant.deaths` - Number of Infant Deaths per 1000 population.
+ `Alcohol` - Alcohol recorded per capita (15+) consumption (in litres of pure alcohol).
+ `percentage.expenditure` - Expenditure on health as a percentage of Gross Domestic Product per capita (%).
+ `Hepatitis.B` - Hepatitis B (HepB) immunization coverage among 1-year-olds (%).
+ `Measles` - Number of reported Measles cases per 1000 population.
+ `BMI` - Average Body Mass Index of entire population.
+ `under.five.deaths` - Number of under-five deaths per 1000 population.
+ `Polio` - Polio (Pol3) immunization coverage among 1-year-olds (%).
+ `Total.expenditure` - General government expenditure on health as a percentage of total government expenditure (%).
+ `Diphtheria` - Diphtheria tetanus toxoid and pertussis (DTP3) immunization coverage among 1-year-olds (%).
+ `HIV.AIDS` - Deaths per 1000 live births due to HIV/AIDS (0-4 years).
+ `GDP` - Gross Domestic Product per capita (in USD).
+ `Population` - Population of the country.
+ `thinness..1.19.years` - Prevalence of thinness among children and adolescents for Age 10 to 19 (%).
+ `thinness.5.9.years` - Prevalence of thinness among children for Age 5 to 9 (%).
+ `Income.composition.of.resources` - Human Development Index in terms of income composition of resources (index ranging from 0 to 1).
+ `Schooling` - Number of years of Schooling (years).

In total, there are 2938 observations of 22 variables with 20 of them being numerical and 2 categorical (`Country` and `Status`).\
We will be using `Life.expectancy` to predict the life expectancy of the human population with the given dependent variables in the dataset.

## Clean Data

We will drop any observation that does not contain any value in any of its columns.

```{r}
life = na.omit(life)
```

This shrinks our dataset to 1649 observations.

\newpage

## Data Exploration

```{r}
summary(life)
```

\newpage

```{r}
par(mfrow = c(1, 2))
boxplot(life$Year, main = 'Year', ylab = 'Year')
hist(life$Year, main = 'Histogram of Year', xlab = 'Year')
```

\newpage

```{r}
par(mfrow = c(1, 2))
boxplot(life$Life.expectancy, main = 'Life Expectancy', ylab = 'Age')
hist(life$Life.expectancy, main = 'Histogram of Life Expectancy', xlab = 'Age')
```

\newpage

```{r}
par(mfrow = c(1, 2))
boxplot(life$Adult.Mortality, main = 'Adult Mortality Rate', ylab = 'Mortality Rates on Both Sexes')
hist(
  life$Adult.Mortality,
  main = 'Histogram of Adult Mortality Rate',
  xlab = 'Mortality Rates on Both Sexes',
  cex.main = 0.9
)
```

\newpage

```{r}
par(mfrow = c(1, 2))
boxplot(life$infant.deaths, main = 'Infant Deaths', ylab = 'Deaths / 1000 Population')
hist(life$infant.deaths, main = 'Histogram of Infant Deaths', xlab = 'Deaths / 1000 Population')
```

\newpage

```{r}
par(mfrow = c(1, 2))
boxplot(life$Alcohol, main = 'Alcohol Consumption', ylab = 'Litres')
hist(life$Alcohol,
     main = 'Histogram of Alcohol Consumption',
     xlab = 'Litres',
     cex.main = 0.9)
```

\newpage

```{r}
par(mfrow = c(1, 2))
boxplot(life$percentage.expenditure,
        main = 'Health Expenditure',
        ylab = '% of GDP per Capita')
hist(
  life$percentage.expenditure,
  main = 'Histogram of Health Expenditure',
  xlab = '% of GDP per Capita',
  cex.main = 0.9
)
```

\newpage

```{r}
par(mfrow = c(1, 2))
boxplot(life$Hepatitis.B,
        main = 'Hepatitis B (HepB) Immunization',
        ylab = '% Coverage Among 1-Year-Olds',
        cex.main = 0.9)
hist(life$Hepatitis.B,
     main = 'Histogram of HepB Immunization',
     xlab = '% Coverage Among 1-Year-Olds',
     cex.main = 0.9)
```

\newpage

```{r}
par(mfrow = c(1, 2))
boxplot(life$Measles, main = 'Measles', ylab = 'Reported Cases / 1000 Population')
hist(life$Measles, main = 'Histogram of Measles', xlab = 'Reported Cases / 1000 Population')
```

\newpage

```{r}
par(mfrow = c(1, 2))
boxplot(life$BMI, main = 'Average BMI', ylab = 'BMI')
hist(life$BMI, main = 'Histogram of Average BMI', xlab = 'BMI')
```

\newpage

```{r}
par(mfrow = c(1, 2))
boxplot(life$under.five.deaths, main = 'Under-Five Deaths', ylab = 'Deaths / 1000 Population')
hist(
  life$under.five.deaths,
  main = 'Histogram of Under-Five Deaths',
  xlab = 'Deaths / 1000 Population',
  cex.main = 0.9
)
```

\newpage

```{r}
par(mfrow = c(1, 2))
boxplot(life$Polio, main = 'Polio (Pol3) Immunization', ylab = '% Coverage Among 1-Year-Olds')
hist(life$Polio,
     main = 'Histogram of Pol3 Immunization',
     xlab = '% Coverage Among 1-Year-Olds',
     cex.main = 0.9)
```

\newpage

```{r}
par(mfrow = c(1, 2))
boxplot(
  life$Total.expenditure,
  main = 'General Government Health Expenditure',
  ylab =
    '% of Total Government Expenditure',
  cex.main = 0.8
)
hist(
  life$Total.expenditure,
  main = 'Histogram of General Government Health Expenditure',
  xlab =
    '% of Total Government Expenditure',
  cex.main = 0.7
)
```

\newpage

```{r}
par(mfrow = c(1, 2))
boxplot(life$Diphtheria, main = 'DTP3 Immunization', ylab = '% Coverage Among 1-Year-Olds')
hist(life$Diphtheria,
     main = 'Histogram of DTP3 Immunization',
     xlab = '% Coverage Among 1-Year-Olds',
     cex.main = 0.9)
```

\newpage

```{r}
par(mfrow = c(1, 2))
boxplot(life$HIV.AIDS, main = 'HIV/AIDS (0-4 Years)', ylab = 'Deaths / 1000 Live Births')
hist(life$HIV.AIDS,
     main = 'Histogram of HIV/AIDS (0-4 Years)',
     xlab = 'Deaths / 1000 Live Births',
     cex.main = 0.9)
```

\newpage

```{r}
par(mfrow = c(1, 2))
boxplot(life$GDP, main = 'GDP per Capita (in USD)', ylab = 'GDP per Capita (in USD)')
hist(life$GDP,
     main = 'Histogram of GDP per Capita (in USD)',
     xlab = 'GDP per Capita (in USD)',
     cex.main = 0.9)
```

\newpage

```{r}
par(mfrow = c(1, 2))
boxplot(life$Population, main = 'Country Population', ylab = 'Country Population')
hist(life$Population,
     main = 'Histogram of Country Population',
     xlab = 'Country Population',
     cex.main = 0.9)
```

\newpage

```{r}
par(mfrow = c(1, 2))
boxplot(
  life$thinness..1.19.years,
  main = 'Prevalence of Thinness (10-19 Years)',
  ylab = '%',
  cex.main = 0.9
)
hist(
  life$thinness..1.19.years,
  main = 'Histogram of Prevalence of Thinness (10-19 Years)',
  xlab = '%',
  cex.main = 0.7
)
```

\newpage

```{r}
par(mfrow = c(1, 2))
boxplot(
  life$thinness.5.9.years,
  main = 'Prevalence of Thinness (5-9 Years)',
  ylab = '%',
  cex.main = 0.9
)
hist(
  life$thinness.5.9.years,
  main = 'Histogram of Prevalence of Thinness (5-9 Years)',
  xlab =
    '%',
  cex.main = 0.7
)
```

\newpage

```{r}
par(mfrow = c(1, 2))
boxplot(life$Income.composition.of.resources, main = 'HDI', ylab='HDI')
hist(life$Income.composition.of.resources, main = 'Histogram of HDI', xlab='HDI')
```

\newpage

```{r}
par(mfrow = c(1, 2))
boxplot(life$Schooling, main = 'Schooling', ylab = 'Years')
hist(life$Schooling, main = 'Histogram of Schooling', xlab = 'Years')
```

## Feature Selection

We will be removing some of the variables for building the model due to the reasons mentioned below:\
`Country` - Contains too many levels with no additional information to predict `Life.expectancy`.\
`Year` - Contains time series data with no additional information to predict `Life.expectancy`.

```{r}
life = life[, !(names(life) %in% c('Country', 'Year'))]
```

We will be mutating `Hepatitis.B`, `Polio` and `Diphtheria` for building the model since their range between the minimum value and the 1st Quartile is too wide. We will be mutating their values into 2 categorical values: '<90% Covered' and '>=90% Covered'.

```{r}
life$Hepatitis.B = ifelse(life$Hepatitis.B < 90, '<90% Covered', '>=90% Covered')
life$Polio = ifelse(life$Polio < 90, '<90% Covered', '>=90% Covered')
life$Diphtheria = ifelse(life$Diphtheria < 90, '<90% Covered', '>=90% Covered')
```

This leaves us with 1649 observations of 20 variables with 16 of them being numerical and 4 categorical (`Status`, `Hepatitis.B`, `Polio` and `Diphtheria`).\

\newpage

```{r}
summary(life)
```

\newpage

## Correlations

Since the number of variables is moderately large, we will plot the correlation plot of the dataset rather than looking at the correlation matrix by itself. The color and its shade easily guide us which 2 variables are correlated.

```{r}
life_nums = unlist(lapply(life, is.numeric), use.names = FALSE)
corrplot(
  cor(life[, life_nums]),
  method = 'number',
  tl.cex = 0.5,
  number.cex = 0.33,
  cl.cex = 0.5
)
```

There are a few takeaways from this correlation plot:

* `Life.expectancy` has a strong positive correlation with `Income.composition.of.resources` and `Schooling`.
* `Life.expectancy` has a negative correlation with `Adult.Mortality`, which makes sense since if the mortality rate of adult is high, then obviously the life expectancy will be low.
* `Life.expectancy` has a very weak correlation with `Measles` and `Population`.
* There is a very strong correlation between `infant.deaths` and `under.five.deaths`, indicating multicollinearity between them. Therefore, we will remove `under.five.deaths` for building the model.

```{r}
life = life[, !(names(life) %in% c('under.five.deaths'))]
```

## Model Building

We will now build a Linear Regression Model using all the remaining variables to predict the life expectancy of the human population.

```{r}
lmod = lm(Life.expectancy ~ ., data = life)
summary(lmod)
```

There are a few takeaways from this model:

* The p-value of the model is 2.2e-16 < 0.05, indicating that it is significant.
* The Adj R-squared value of the model is 0.8244, indicating that about 82.44% of the observed variation can be explained by the variables in the model, which is quite a good result and can possibly be improved even further with model selection.
* `Adult.Mortality`, `Alcohol`, `BMI`, `HIV.AIDS`, `Income.composition.of.resources` and `Schooling` are the most significant variables with p-value < 0.5.
* From the model we can interpret that `StatusDeveloping`, `Adult.Mortality`, `infant.deaths`, `Alcohol`, `HIV.AIDS`, and `thinness..1.19.years`  may have a negative effect on life expectancy.
* From the model we can interpret that `Income.composition.of.resources` has a strong positive effect on life expectancy.
* A peculiar result we can interpret from the model is that `Hepatitis.B90% Covered` also has a negative effect on life expectancy.

## Model Selection

We will now generate models by using different techniques like Forward Selection Method, Backward Elimination Method and Stepwise Selection Method.

Build Model using Forward Selection Method.

```{r}
ols_step_forward_p(lmod)
```

```{r}
lmod_forward = lm(
  Life.expectancy ~  Schooling + HIV.AIDS + Adult.Mortality + Income.composition.of.resources + percentage.expenditure +
    BMI + Diphtheria + Alcohol + thinness..1.19.years + Status + Hepatitis.B +
    Total.expenditure + infant.deaths + Measles + Population + Polio,
  data = life
)
summary(lmod_forward)
```

Build Model using Backward Elimination Method.

```{r}
ols_step_backward_p(lmod)
```

```{r}
lmod_backward = lm(
  Life.expectancy ~ Status + Adult.Mortality + infant.deaths + Alcohol +
    percentage.expenditure + Hepatitis.B + Measles + BMI + Polio + Total.expenditure +
    Diphtheria + HIV.AIDS + Population + thinness..1.19.years + Income.composition.of.resources +
    Schooling,
  data = life
)
summary(lmod_backward)
```

\newpage

Build Model using Stepwise Selection Method.

```{r}
ols_step_both_p(lmod)
```

```{r}
lmod_stepwise = lm(
  Life.expectancy ~ Schooling + HIV.AIDS + Adult.Mortality + Income.composition.of.resources +
    percentage.expenditure + BMI + Diphtheria + Alcohol + thinness..1.19.years +
    Status + Hepatitis.B,
  data = life
)
summary(lmod_stepwise)
```

Build Model using All Possible Regressions Method.

```{r}
# ols_step_all_possible(lmod, sbc = TRUE)
```

\newpage

In summary, variables chosen by the methods (x denotes the variable was chosen by the method):

| Model Selection Method | `Status` | `Adult.Mortality` | `infant.deaths` | `Alcohol` |
|-----------------------:|:--------:|:-----------------:|:---------------:|:---------:|
| Forward Selection      |    x     |         x         |        x        |     x     |
| Backward Elimination   |    x     |         x         |        x        |     x     |
| Stepwise Selection     |    x     |         x         |                 |     x     |

| Model Selection Method | `percentage.expenditure` | `Hepatitis.B` | `Measles` | `BMI` | `Polio` |
|-----------------------:|:------------------------:|:-------------:|:---------:|:-----:|:-------:|
| Forward Selection      |            x             |       x       |     x     |   x   |    x    |
| Backward Elimination   |            x             |       x       |     x     |   x   |    x    |
| Stepwise Selection     |            x             |       x       |           |   x   |         |

| Model Selection Method | `Total.expenditure` | `Diphtheria` | `HIV.AIDS` | `GDP` | `Population` |
|-----------------------:|:-------------------:|:------------:|:----------:|:-----:|:------------:|
| Forward Selection      |          x          |      x       |     x      |       |      x       |
| Backward Elimination   |          x          |      x       |     x      |       |      x       |
| Stepwise Selection     |                     |      x       |     x      |       |              |

| Model Selection Method | `thinness..1.19.years` | `thinness.5.9.years` |
|-----------------------:|:----------------------:|:--------------------:|
| Forward Selection      |           x            |                      |
| Backward Elimination   |           x            |                      |
| Stepwise Selection     |           x            |                      |

| Model Selection Method | `Income.compostition.of.resources` | `Schooling` |
|-----------------------:|:----------------------------------:|:-----------:|
| Forward Selection      |                 x                  |      x      |
| Backward Elimination   |                 x                  |      x      |
| Stepwise Selection     |                 x                  |      x      |

Both the Forward Selection method and Backward Elimination method have chosen the same set of variables.

Adj. R-squared values of the above models:

```{r}
data.frame(
  model = c('lmod', 'lmod_forward', 'lmod_backward', 'lmod_stepwise'),
  AdjRsquare = c(
    summary(lmod)$adj.r.square,
    summary(lmod_forward)$adj.r.square,
    summary(lmod_backward)$adj.r.square,
    summary(lmod_stepwise)$adj.r.square
  )
)
```

We will be choosing the model chosen by Forward Selection method `lmod_forward` as it has the highest Adj. R-squared value. 

```{r}
lmod_final = lmod_forward
summary(lmod_final)
```

\newpage

# Results

## Model Error Estimation

We will now use our final model to see how well it performs in predicting the life expectancy of the human population.

```{r}
result = predict(lmod_final, life)
```

Mean Squared Error: 
```{r}
mse = mean((life$Life.expectancy - result) ^ 2)
mse
```

Root Mean Squared Error:
```{r}
rmse = sqrt(mse)
rmse
```

Mean Absolute Error:
```{r}
n = length(result)
sum = 0

for (i in 1:n) {
  sum = sum + abs(life$Life.expectancy[i] - result[i])
}

mae = sum / n
mae
```

In summary,

```{r}
data.frame(
  Method = c('MSE', 'RMSE', 'MAE'),
  Result = c(mse, rmse, mae)
)
```

\newpage

## Model Adequacy Checking

Normality Testing:

```{r}
hist(lmod_final$residuals, breaks = 20)
```

Most of the residuals seem to be distributed in the center, indicating that they are distributed normally.

\newpage

```{r}
plot(lmod_final, which = c(1:6))
```

There is no obvious observable pattern in the above plots, indicating that the model is appropriate.

Multicollinearity Test:

```{r}
vif(lmod_final)
```

A VIF > 10 implies serious problems with multicollinearity.\
Since the VIF for all of the predictors is less than 10, there seems to be no issue with multicollinearity.

\newpage

# Discussion

